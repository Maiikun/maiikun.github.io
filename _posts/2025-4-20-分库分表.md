首先先讲解一下为什么要分库分表、什么时候需要分库分表、怎么进行分库分表。

### 为什么要分库分表？
在数据量以及访问量上升的环境下，传统的SQL优化达到瓶颈，又或是增加硬件成本较高。我们可以将数据分散到多个表或多个库中。关系型数据库本身比较容易成为系统瓶颈，单机存储容量、连接数、处理能力都有限。当单表的数据量达到1000W或100G以后，由于查询维度较多，即使**添加从库、优化索引**，做很多操作时性能仍下降严重。此时就要考虑对其进行切分了，切分的目的就在于减少数据库的负担，缩短查询时间。


### 什么时候需要分库分表？

#### 分库分表的概念：
只分表：单表数据量大，读写出现瓶颈，这个表所在的库还可以支撑未来几年的增长。
只分库：整个数据库读写出现性能瓶颈，将整个库拆开。
分库分表：单表数据量大，所在库也出现性能瓶颈，就要既分库又分表。
垂直拆分：把字段分开。例如spu表的pic字段特别长，建议把这个pic字段拆到另一个表（同库或不同库）。
水平拆分：把记录分开。例如表数据量到达百万，我们拆成四张20万的表。

#### 多少数据量需要拆分？
上面提到1000W以后需要进行拆分，其实是需要根据实际的情况来判断的。
为什么说是1000W？其实阿里规范中是单表达到500W就需要进行拆分了。这个数据是怎么算出来的？

以 MySQL 的 **InnoDB 引擎** 为例：
InnoDB 使用 B+树索引。数据量越大，B+树的高度越高（比如从3层变成4层），导致每次查找需要更多磁盘IO。InnoDB的存储是以页为单位的，一页的大小除去页头页尾大概还有16000，其中非叶子节点是不存储实际数据的，只存储对应的指针14KB（主键为 BIGINT（8字节），页指针为 6 字节）。那么一页可以存储的指针数量为16000 / 14 ≈ 1170
假设每条记录 150 字节，每页可存储的数据条数为16000 × 0.7 / 150 ≈ 76 条，那么3层的B+树能存储的数据大概就是 1170 * 1170 * 76 = 104,036,400 条。

虽然理论上三层 B+ 树可以支持上亿条数据，但现实远没这么理想。实际查询复杂，多表 join、排序、分组等会加剧性能压力。





